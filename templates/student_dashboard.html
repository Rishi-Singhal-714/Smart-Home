<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard - Home Automation Control</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Reset and base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #6a11cb, #2575fc);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: #333;
            position: relative;
        }

        /* Logout icon style */
        .logout-icon {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 24px;
            color: #fff;
            cursor: pointer;
        }

        .logout-icon:hover {
            color: #ff5733;
        }

        .container {
            background-color: #ffffff;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .logo img {
            width: 100px;
            margin-bottom: 20px;
        }

        h1 {
            font-size: 22px;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        h2 {
            font-size: 18px;
            color: #34495e;
            margin-bottom: 20px;
        }

        label {
            font-size: 14px;
            font-weight: bold;
            display: block;
            margin-bottom: 10px;
            text-align: left;
            color: #555;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
            margin-bottom: 20px;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #4caf50;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        button {
            background-color: #007bff;
            color: #fff;
            border: none;
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s ease;
            width: 100%;
            margin-bottom: 15px;
        }

        button:hover {
            background-color: #0056b3;
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .button-group a {
            flex: 1 1 calc(50% - 10px);
            text-decoration: none;
        }
        /* Centering the microphone container */
.mic-container {
    text-align: center;
    margin-bottom: 20px;
}

/* Styling the microphone icon */
.mic-container .fas.fa-microphone {
    font-size: 24px;
    color: #555;
    cursor: pointer;
    transition: color 0.3s ease;
}

.mic-container .fas.fa-microphone:hover {
    color: #4caf50; /* Optional hover color */
}

/* Caption below the microphone */
.mic-container p {
    margin-top: 5px;
    font-size: 14px;
    color: #555;
}


        #response {
            margin-top: 20px;
            font-size: 14px;
            color: #333;
            background: #f1f1f1;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>

    <!-- Logout Icon -->
    <div class="logout-icon">
        <i class="fas fa-sign-out-alt" onclick="logout()"></i>
    </div>

    <div class="container">
        <div class="logo">
            <img src="https://www.vips.edu/logo.png" alt="VIP Logo">
        </div>

        <h1>Welcome, {{ student_name }}</h1>
        <h2>Home Automation Control</h2>
        <div class="mic-container">
            <i class="fas fa-microphone" id="mic-icon" onclick="toggleSpeechRecognition()"></i>
            <p>Click to Speak</p>
        </div>
        
        <label for="fan_slider">Fan Speed (0, 50, 100):</label>
        <input type="range" id="fan_slider" name="fan_slider" min="0" max="100" step="50" value="0" oninput="sendFanControl()">

        <label>Light Control:</label>
        <button id="light_on" onclick="sendLightControl('on')">Turn Light ON</button>
        <button id="light_off" onclick="sendLightControl('off')">Turn Light OFF</button>

        <div class="button-group">
            <a href="/chat"><button>Chat</button></a>
        </div>

        <div id="response"></div>
    </div>

    <script>
        let fanSpeed = 0;

        function sendFanControl() {
            const fanSlider = document.getElementById('fan_slider');
            fanSpeed = fanSlider.value;
            const xhr = new XMLHttpRequest();
            xhr.open('POST', '/control_fan', true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.onload = function () {
                document.getElementById('response').innerHTML = xhr.status === 200 ? xhr.responseText : 'Error sending fan control command.';
            };
            xhr.send(`fan_slider=${fanSpeed}`);
        }

        function sendLightControl(state) {
            const xhr = new XMLHttpRequest();
            xhr.open('POST', '/control_light', true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.onload = function () {
                document.getElementById('response').innerHTML = xhr.status === 200 ? xhr.responseText : 'Error sending light control command.';
            };
            xhr.send(`light_state=${state}`);
        }

let isListening = false;

// Speech recognition setup
const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
recognition.continuous = true;
recognition.interimResults = false;
recognition.lang = 'en-IN';

// Text-to-speech setup
const synth = window.speechSynthesis;

function speakResponse(response) {
    const utterance = new SpeechSynthesisUtterance(response);
    utterance.lang = 'en-IN';
    synth.speak(utterance);
}

// Speech recognition events
recognition.onresult = (event) => {
    const command = event.results[event.results.length - 1][0].transcript.trim().toLowerCase();
    document.getElementById('response').innerHTML = `Heard: ${command}`;

    // Respond to commands
    if (command.includes('hi cliff') || command.includes('ok cliff') || command.includes('cliff')) {
        speakResponse("Hello! How can I assist you today?");
    } else if (command.includes('please tell about my project')) {
        const projectInfo = `
            Your project is a home automation system allowing admins to control lights and fans.
            It supports voice commands, user registration, and usage history management.
            You can also communicate with me for real-time assistance!
        `;
        speakResponse(projectInfo);
        document.getElementById('response').innerHTML = projectInfo;
    }else if (command.includes('please tell me about my project')) {
        const projectInfo = `
            Your project is a home automation system allowing admins to control lights and fans.
            It supports voice commands, user registration, and usage history management.
            You can also communicate with me for real-time assistance!
        `;
        speakResponse(projectInfo);
        document.getElementById('response').innerHTML = projectInfo;
    } else if (command.includes('what is the date') || command.includes('what is the time')) {
        const now = new Date();
        const dateTimeInfo = `
            Today is ${now.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}.
            The current time is ${now.toLocaleTimeString('en-US')}.
        `;
        speakResponse(dateTimeInfo);
        document.getElementById('response').innerHTML = dateTimeInfo;
    } else if (command === 'turn on light') {
        sendLightControl('on');
        speakResponse("Light has been turned on.");
    } else if (command === 'turn off light') {
        sendLightControl('off');
        speakResponse("Light has been turned off.");
    } else if (command === 'turn on fan') {
        fanSpeed = 50;
        document.getElementById('fan_slider').value = fanSpeed;
        sendFanControl();
        speakResponse("Fan is now running at medium speed.");
    } else if (command === 'turn off fan') {
        fanSpeed = 0;
        document.getElementById('fan_slider').value = fanSpeed;
        sendFanControl();
        speakResponse("Fan has been turned off.");
    } else if (command === 'set fan to high') {
        fanSpeed = 100;
        document.getElementById('fan_slider').value = fanSpeed;
        sendFanControl();
        speakResponse("Fan is now running at high speed.");
    } else {
        speakResponse("Sorry, I didn't understand that command.");
    }
};

// Start or stop recognition
function toggleSpeechRecognition() {
    const micIcon = document.getElementById('mic-icon');

    if (!isListening) {
        recognition.start();
        micIcon.style.color = '#4caf50'; // Change icon color to green when active
        document.getElementById('response').innerHTML = 'Listening...';
    } else {
        recognition.stop();
        micIcon.style.color = '#555'; // Reset icon color to default
        document.getElementById('response').innerHTML = 'Stopped listening.';
    }

    isListening = !isListening;
}

// Start recognition automatically
recognition.start();

        // Logout function
        function logout() {
            // Redirect to the logout page or perform any logout action
            window.location.href = '/logout'; // Replace with your logout URL
        }
    </script>
</body>
</html>
